gpasm-2.2.15 (Dec 17 2019)   Charge_Mc30p6240(14sop)_xxxx.asm2020-6-30  15:50:10          PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 INCLUDE MC30P6240.INC
                      00001                 LIST
                      00002 ;mc30p6240.inc    Standard Header File, Version 1.00 by Sinomcu
                      00367                 LIST
                      00002 ;LED DIM CONTROL FOR HONGYUAN
                      00003 ;EDITED BY COSTA 2020-06-24
                      00004 ;14SOP
                      00005 ;FSYS:8M/2
                      00006 ;=======================================
                      00007 ;BYTE DEFINE SECTION
                      00008 #DEFINE FLAGBUF         0x10
                      00009 #DEFINE ACCBUF          0x11
                      00010 #DEFINE TMP0            0X12
                      00011 #DEFINE FLAG0           0X13
                      00012 #DEFINE F_K_RND         FLAG0,0
                      00013 #DEFINE F_T1            FLAG0,1
                      00014 #DEFINE F_T2            FLAG0,2
                      00015 #DEFINE F_T3            FLAG0,3
                      00016 #DEFINE F_WK0           FLAG0,5         ;手电筒工作
                      00017 #DEFINE F_WK1           FLAG0,6         ;红外灯工作
                      00018 #DEFINE F_WK2           FLAG0,7         ;外部开关工作
                      00019 #DEFINE KFLAG           0X14
                      00020 #DEFINE F_PR1           KFLAG,0
                      00021 #DEFINE F_PR2           KFLAG,1
                      00022 #DEFINE F_PR3           KFLAG,2
                      00023 #DEFINE F_PRS           KFLAG,3
                      00024 #DEFINE F_H1            KFLAG,4
                      00025 #DEFINE F_H2            KFLAG,5
                      00026 #DEFINE F_PRESSED       KFLAG,6
                      00027 #DEFINE F_HOLD          KFLAG,7
                      00028 
                      00029 #DEFINE DEBOUNCE        0X15
                      00030 #DEFINE HOLD_CNT        0X16
                      00031 #DEFINE HALT_CNT        0X17
                      00032 #DEFINE KEYIN           0X18
                      00033 #DEFINE KEYOLD          0X19
                      00034 #DEFINE FLAG1           0X1A
                      00035 #DEFINE F_ACTED         FLAG1,0
                      00036 #DEFINE F_NO_WK         FLAG1,1
                      00037 #DEFINE F_WK1_1         FLAG1,2
                      00038 #DEFINE F_UP            FLAG1,3
                      00039 #DEFINE F_INC_EN        FLAG1,4
                      00040 #DEFINE STG1            0X1B
                      00041 #DEFINE STG2            0X1C
                      00042 #DEFINE STG3            0X1D
                      00043 #DEFINE DLY1            0X1E
                      00044 #DEFINE DLY2            0X1F
                      00045 #DEFINE CNT50MS         0X20
                      00046 #DEFINE TM_CNT          0X21
                      00047 #DEFINE DUTY_BK         0X22
                      00048 #DEFINE KEY_CNT         0X23
                      00049 
                      00050 ;=======================================
                      00051 ;PORT DEFINE SECTION
                      00052 #DEFINE P_PSW3          P00D
                      00053 #DEFINE P_KLED          P01D
                      00054 #DEFINE P_SLED          P02D
                      00055 #DEFINE P_RLED          P03D
                      00056 #DEFINE P_PWMC          P10D
                      00057 #DEFINE P_PWMB          P11D
                      00058 #DEFINE P_PWMA          P12D
                      00059 #DEFINE P_KYR           P13D
                      00060 #DEFINE P_KYS           P14D
                      00061 #DEFINE P_KYK           P15D
                      00062 
                      00063 
                      00064 
                      00065 ;=======================================
                      00066                                 ORG     0x00                    ;起始地址
0000   000E           00067                                 CLRWDT
0001   1D8E           00068                                 CLRR    INTE
0002   1D8F           00069                                 CLRR    INTF
0003   1DC4           00070                                 CLRR    INTF1
0004   2800           00071                         GOTO    PWON_Start              ;调到程序运行
                      00072         
                      00073                         ORG     0x08            ;进入中断地址
0008   1591           00074                                 MOVRA   ACCBUF
0009   1603           00075                                 MOVAR   STATUS
000A   1590           00076                                 MOVRA   FLAGBUF
000B   300F           00077                                 JBSET   T0IF
000C   2800           00078                                 GOTO    INT_EXIT
000D   3C0F           00079                                 BCLR    T0IF    ;EVERY (64/4M)*256=4096US
000E   3A1A           00080                                 BSET    F_INC_EN
000F   19A3           00081                                 INCR    KEY_CNT
0010   0B04           00082                                 MOVAI   4
0011   1223           00083                                 RSUBAR  KEY_CNT
0012   3003           00084                                 JBSET   C
0013   2800           00085                                 GOTO    INT_EXIT
0014   1DA3           00086                                 CLRR    KEY_CNT
0015   3813           00087                                 BSET    F_K_RND
0016   1617           00088                                 MOVAR   HALT_CNT
0017   0800           00089                                 XORAI   0
0018   3103           00090                                 JBSET   Z
0019   1B97           00091                                 DECR    HALT_CNT
001A   19A0           00092                                 INCR    CNT50MS
001B   0B03           00093                                 MOVAI   3
001C   1220           00094                                 RSUBAR  CNT50MS
001D   3003           00095                                 JBSET   C
001E   2800           00096                                 GOTO    INT_EXIT
001F   1DA0           00097                                 CLRR    CNT50MS
0020   161E           00098                                 MOVAR   DLY1
0021   0800           00099                                 XORAI   0
0022   3103           00100                                 JBSET   Z
0023   1B9E           00101                                 DECR    DLY1
0024   161F           00102                                 MOVAR   DLY2
0025   0800           00103                                 XORAI   0
0026   3103           00104                                 JBSET   Z
0027   1B9F           00105                                 DECR    DLY2
0028                  00106 INT_EXIT:
0028   1D8F           00107                                 CLRR    INTF
0029   1610           00108                                 MOVAR   FLAGBUF
002A   1583           00109                                 MOVRA   STATUS
002B   1611           00110                                 MOVAR   ACCBUF
002C   000D           00111                                 RETIE
002D                  00112 PWON_Start:
002D   1DC5           00113                                 CLRR    DDR0
002E   1DC6           00114                                 CLRR    DDR1
002F   1D85           00115                                 CLRR    P0
0030   1D86           00116                                 CLRR    P1
0031   0B50           00117                                 MOVAI   0X50
0032   1592           00118                                 MOVRA   TMP0
0033                  00119 PWON_WAIT:
0033   000E           00120                                 CLRWDT
0034   1A92           00121                                 DJZR    TMP0
0035   2800           00122                                 GOTO    PWON_WAIT
0036   2000           00123                                 CALL    HDWARE_INITIAL
0037   2000           00124                                 CALL    RAM_CLR
0038   2000           00125                                 CALL    USR_INITIAL
                      00126 ;=======================================
                      00127 ;;;;;;;;;;;MAIN LOOP SECTION;;;;;;;;;;;;
                      00128 ;=======================================
0039                  00129 MAIN:
0039   000E           00130                                 CLRWDT
003A   2000           00131                                 CALL    KEY_SCAN
003B   2000           00132                                 CALL    GET_STATE
003C   2000           00133                                 CALL    OUTPUT
003D   2800           00134                                 GOTO    MAIN    ;FOR TEST
003E                  00135 HALT_CHK:
003E   3594           00136                                 JBCLR   F_PRS
003F   2800           00137                                 GOTO    MAIN
0040   3693           00138                                 JBCLR   F_WK0
0041   2800           00139                                 GOTO    MAIN
0042   3713           00140                                 JBCLR   F_WK1
0043   2800           00141                                 GOTO    MAIN
0044   3793           00142                                 JBCLR   F_WK2
0045   2800           00143                                 GOTO    MAIN
0046   1617           00144                                 MOVAR   HALT_CNT
0047   0800           00145                                 XORAI   0
0048   3103           00146                                 JBSET   Z
0049   2800           00147                                 GOTO    MAIN
004A   161E           00148                                 MOVAR   DLY1
004B   0800           00149                                 XORAI   0
004C   3103           00150                                 JBSET   Z
004D   2800           00151                                 GOTO    MAIN
004E   161F           00152                                 MOVAR   DLY2
004F   0800           00153                                 XORAI   0
0050   3103           00154                                 JBSET   Z
0051   2800           00155                                 GOTO    MAIN
0052   0000           00156                                 NOP
0053   0000           00157                                 NOP
0054   000B           00158                                 STOP
0055   0000           00159                                 NOP
0056   0000           00160                                 NOP
0057   2800           00161                                 GOTO    MAIN
                      00162 ;;;;;;;;;;;;;MAIN LOOP END;;;;;;;;;;;;;;
                      00163 ;=======================================
                      00164 ;SUBROUTINE SECTION
0058                  00165 KEY_SCAN:
0058   000E           00166                                 CLRWDT
0059   3013           00167                                 JBSET   F_K_RND
005A   2800           00168                                 GOTO    KEY_SCAN_EXIT
005B   3C13           00169                                 BCLR    F_K_RND
005C   1D98           00170                                 CLRR    KEYIN
005D   3206           00171                                 JBSET   P_KYS
005E   3818           00172                                 BSET    KEYIN,0
005F   3186           00173                                 JBSET   P_KYR
0060   3898           00174                                 BSET    KEYIN,1
0061   3286           00175                                 JBSET   P_KYK
0062   3918           00176                                 BSET    KEYIN,2
0063   1618           00177                                 MOVAR   KEYIN
0064   0800           00178                                 XORAI   0
0065   3503           00179                                 JBCLR   Z
0066   2800           00180                                 GOTO    NOKEY_PRO
0067   1618           00181                                 MOVAR   KEYIN
0068   1019           00182                                 XORAR   KEYOLD
0069   3103           00183                                 JBSET   Z
006A   2800           00184                                 GOTO    NEWKEY_PRO
006B   1995           00185                                 INCR    DEBOUNCE
006C   0B04           00186                                 MOVAI   0X04
006D   1215           00187                                 RSUBAR  DEBOUNCE
006E   3003           00188                                 JBSET   C
006F   2800           00189                                 GOTO    KEY_SCAN_EXIT
0070   0B04           00190                                 MOVAI   0X04
0071   1595           00191                                 MOVRA   DEBOUNCE
0072   3714           00192                                 JBCLR   F_PRESSED
0073   2800           00193                                 GOTO    KEY_HLD_CHK
0074   3B14           00194                                 BSET    F_PRESSED
0075   2800           00195                                 GOTO    K_PRS_HLD_CHK
0076                  00196 KEY_HLD_CHK:
0076   3794           00197                                 JBCLR   F_HOLD
0077   2800           00198                                 GOTO    KEY_SCAN_EXIT
0078   1996           00199                                 INCR    HOLD_CNT
0079   0B60           00200                                 MOVAI   0X60
007A   1216           00201                                 RSUBAR  HOLD_CNT
007B   3003           00202                                 JBSET   C
007C   2800           00203                                 GOTO    KEY_SCAN_EXIT
007D   0B60           00204                                 MOVAI   0X60
007E   1596           00205                                 MOVRA   HOLD_CNT
007F   3B94           00206                                 BSET    F_HOLD
0080                  00207 K_PRS_HLD_CHK:
0080   0B7A           00208                                 MOVAI   122
0081   1597           00209                                 MOVRA   HALT_CNT
0082   1618           00210                                 MOVAR   KEYIN
0083   0801           00211                                 XORAI   00000001B
0084   3503           00212                                 JBCLR   Z
0085   2800           00213                                 GOTO    K1_PRO
0086   1618           00214                                 MOVAR   KEYIN
0087   0802           00215                                 XORAI   00000010B
0088   3503           00216                                 JBCLR   Z
0089   2800           00217                                 GOTO    K2_PRO
008A   1618           00218                                 MOVAR   KEYIN
008B   0804           00219                                 XORAI   00000100B
008C   3503           00220                                 JBCLR   Z
008D   2800           00221                                 GOTO    K3_PRO
008E   2800           00222                                 GOTO    KEY_SCAN_EXIT
008F                  00223 K1_PRO:         ;手电筒开关
008F   3794           00224                                 JBCLR   F_HOLD
0090   2800           00225                                 GOTO    K1_HLD_PRO
0091   3814           00226                                 BSET    F_PR1
0092   3E14           00227                                 BCLR    F_H1
0093   2800           00228                                 GOTO    KEY_SCAN_EXIT
0094                  00229 K1_HLD_PRO:
0094   3C14           00230                                 BCLR    F_PR1
0095   3A14           00231                                 BSET    F_H1
0096   2800           00232                                 GOTO    KEY_SCAN_EXIT
0097                  00233 K2_PRO:         ;红白灯板开关
0097   3794           00234                                 JBCLR   F_HOLD
0098   2800           00235                                 GOTO    K2_HLD_PRO
0099   3894           00236                                 BSET    F_PR2
009A   3E94           00237                                 BCLR    F_H2
009B   2800           00238                                 GOTO    KEY_SCAN_EXIT
009C                  00239 K2_HLD_PRO:
009C   3C94           00240                                 BCLR    F_PR2
009D   3A94           00241                                 BSET    F_H2
009E   2800           00242                                 GOTO    KEY_SCAN_EXIT
009F                  00243 K3_PRO:         ;外部开关
009F   3914           00244                                 BSET    F_PR3
00A0   3993           00245                                 BSET    F_T3
00A1   2800           00246                                 GOTO    KEY_SCAN_EXIT
00A2                  00247 NEWKEY_PRO:
00A2   3994           00248                                 BSET            F_PRS
00A3   1618           00249                                 MOVAR   KEYIN
00A4   1599           00250                                 MOVRA   KEYOLD
00A5   0B04           00251                                 MOVAI   0X04
00A6   1595           00252                                 MOVRA   DEBOUNCE
00A7   2800           00253                                 GOTO    KEY_SCAN_EXIT
00A8                  00254 NOKEY_PRO:
00A8   3414           00255                                 JBCLR   F_PR1
00A9   3893           00256                                 BSET    F_T1
00AA   3494           00257                                 JBCLR   F_PR2
00AB   3913           00258                                 BSET    F_T2
00AC   1D94           00259                                 CLRR    KFLAG
00AD   1D99           00260                                 CLRR    KEYOLD
00AE   1D95           00261                                 CLRR    DEBOUNCE
00AF   1D96           00262                                 CLRR    HOLD_CNT
00B0   3C1A           00263                                 BCLR    F_ACTED
00B1                  00264 KEY_SCAN_EXIT:
00B1   000C           00265                                 RETURN
                      00266 ;=======================================
00B2                  00267 GET_STATE:
00B2   000E           00268                                 CLRWDT
00B3   3093           00269                                 JBSET   F_T1
00B4   2800           00270                                 GOTO    K1_HLD_CHK
00B5   3C93           00271                                 BCLR    F_T1
00B6   3693           00272                                 JBCLR   F_WK0
00B7   2800           00273                                 GOTO    WK0_STG_CHK
00B8                  00274 A_STG3:
00B8   3A93           00275                                 BSET    F_WK0
00B9   3C9A           00276                                 BCLR    F_NO_WK
00BA   164E           00277                                 MOVAR   T1LOAD
00BB   15CF           00278                                 MOVRA   T1DATA
00BC   0B04           00279                                 MOVAI   00000100B
00BD   159B           00280                                 MOVRA   STG1
00BE   3BC8           00281                                 BSET    PWM1AOE
00BF   2800           00282                                 GOTO    GET_STATE_EXIT
00C0                  00283 WK0_STG_CHK:
00C0   341B           00284                                 JBCLR   STG1,0
00C1   2800           00285                                 GOTO    STOP_PWMA
00C2   3C03           00286                                 BCLR    C
00C3   139B           00287                                 RRR             STG1
00C4   341B           00288                                 JBCLR   STG1,0
00C5   2800           00289                                 GOTO    A_STG1
00C6   349B           00290                                 JBCLR   STG1,1
00C7   2800           00291                                 GOTO    A_STG2
00C8   351B           00292                                 JBCLR   STG1,2
00C9   2800           00293                                 GOTO    A_STG3
00CA   2800           00294                                 GOTO    STOP_PWMA
00CB                  00295 A_STG1:
00CB   0B4B           00296                                 MOVAI   75
00CC   15CF           00297                                 MOVRA   T1DATA
00CD   2800           00298                                 GOTO    GET_STATE_EXIT
00CE                  00299 A_STG2:
00CE   0B14           00300                                 MOVAI   20
00CF   15CF           00301                                 MOVRA   T1DATA
00D0   2800           00302                                 GOTO    GET_STATE_EXIT
00D1                  00303 K1_HLD_CHK:
00D1   3214           00304                                 JBSET   F_H1
00D2   2800           00305                                 GOTO    K2_PRS_CHK
00D3   341A           00306                                 JBCLR   F_ACTED
00D4   2800           00307                                 GOTO    K2_PRS_CHK
00D5   381A           00308                                 BSET    F_ACTED
00D6                  00309 STOP_PWMA:
00D6   3E93           00310                                 BCLR    F_WK0
00D7   1D9B           00311                                 CLRR    STG1
00D8   3FC8           00312                                 BCLR    PWM1AOE
00D9   3D06           00313                                 BCLR    P_PWMA
00DA   3713           00314                                 JBCLR   F_WK1
00DB   2800           00315                                 GOTO    GET_STATE_EXIT
00DC   0B66           00316                                 MOVAI   102
00DD   159E           00317                                 MOVRA   DLY1
00DE   2800           00318                                 GOTO    GET_STATE_EXIT
00DF                  00319 K2_PRS_CHK:
00DF   3113           00320                                 JBSET   F_T2
00E0   2800           00321                                 GOTO    K2_HLD_CHK
00E1   3D13           00322                                 BCLR    F_T2
00E2   3713           00323                                 JBCLR   F_WK1
00E3   2800           00324                                 GOTO    WK1_STG_CHK
00E4                  00325 B_STG5: ;白灯亮
00E4   3B13           00326                                 BSET    F_WK1
00E5   3C9A           00327                                 BCLR    F_NO_WK
00E6   3D1A           00328                                 BCLR    F_WK1_1
00E7   164E           00329                                 MOVAR   T1LOAD
00E8   15C9           00330                                 MOVRA   T1DATB
00E9   3EC8           00331                                 BCLR    PWM1COE
00EA   3C06           00332                                 BCLR    P_PWMC
00EB   0B10           00333                                 MOVAI   00010000B
00EC   159C           00334                                 MOVRA   STG2
00ED   3B48           00335                                 BSET    PWM1BOE
00EE   2800           00336                                 GOTO    GET_STATE_EXIT
00EF                  00337 WK1_STG_CHK:
00EF   341C           00338                                 JBCLR   STG2,0
00F0   2800           00339                                 GOTO    STOP_PWMBC
00F1   3C03           00340                                 BCLR    C
00F2   139C           00341                                 RRR             STG2
00F3   341C           00342                                 JBCLR   STG2,0
00F4   2800           00343                                 GOTO    B_STG1
00F5   349C           00344                                 JBCLR   STG2,1
00F6   2800           00345                                 GOTO    B_STG2
00F7   351C           00346                                 JBCLR   STG2,2
00F8   2800           00347                                 GOTO    B_STG3
00F9   359C           00348                                 JBCLR   STG2,3
00FA   2800           00349                                 GOTO    B_STG4
00FB   361C           00350                                 JBCLR   STG2,4
00FC   2800           00351                                 GOTO    B_STG5
00FD   2800           00352                                 GOTO    STOP_PWMBC
00FE                  00353 B_STG1:;红灯亮
00FE   3F48           00354                                 BCLR    PWM1BOE
00FF   3C86           00355                                 BCLR    P_PWMB
0100   0B40           00356                                 MOVAI   64
0101   15CA           00357                                 MOVRA   T1DATC
0102   3AC8           00358                                 BSET    PWM1COE
0103   2800           00359                                 GOTO    GET_STATE_EXIT
0104                  00360 B_STG2:;红灯快闪
0104   3F48           00361                                 BCLR    PWM1BOE
0105   3C86           00362                                 BCLR    P_PWMB
0106   0B40           00363                                 MOVAI   64
0107   15CA           00364                                 MOVRA   T1DATC
0108   1DA1           00365                                 CLRR    TM_CNT
0109   1DA3           00366                                 CLRR    KEY_CNT
010A   3E1A           00367                                 BCLR    F_INC_EN
010B   3AC8           00368                                 BSET    PWM1COE
010C   2800           00369                                 GOTO    GET_STATE_EXIT
010D                  00370 B_STG3:;红灯SOS
010D   3F48           00371                                 BCLR    PWM1BOE
010E   3C86           00372                                 BCLR    P_PWMB
010F   0B01           00373                                 MOVAI   01
0110   15CA           00374                                 MOVRA   T1DATC
0111   15A2           00375                                 MOVRA   DUTY_BK
0112   399A           00376                                 BSET    F_UP
0113   1DA3           00377                                 CLRR    KEY_CNT
0114   3E1A           00378                                 BCLR    F_INC_EN
0115   3AC8           00379                                 BSET    PWM1COE
0116   2800           00380                                 GOTO    GET_STATE_EXIT
0117                  00381 B_STG4:;白灯暗
0117   3EC8           00382                                 BCLR    PWM1COE
0118   3C06           00383                                 BCLR    P_PWMC
0119   0B32           00384                                 MOVAI   50
011A   15C9           00385                                 MOVRA   T1DATB
011B   3B48           00386                                 BSET    PWM1BOE
011C   2800           00387                                 GOTO    GET_STATE_EXIT
011D                  00388 K2_HLD_CHK:
011D   3294           00389                                 JBSET   F_H2
011E   2800           00390                                 GOTO    K3_PRS_CHK
011F   341A           00391                                 JBCLR   F_ACTED
0120   2800           00392                                 GOTO    K3_PRS_CHK
0121   381A           00393                                 BSET    F_ACTED
0122                  00394 STOP_PWMBC:
0122   3F13           00395                                 BCLR    F_WK1
0123   1D9C           00396                                 CLRR    STG2
0124   3F48           00397                                 BCLR    PWM1BOE
0125   3C86           00398                                 BCLR    P_PWMB
0126   3EC8           00399                                 BCLR    PWM1COE
0127   3C06           00400                                 BCLR    P_PWMC
0128   3693           00401                                 JBCLR   F_WK0
0129   2800           00402                                 GOTO    GET_STATE_EXIT
012A   0B66           00403                                 MOVAI   102
012B   159E           00404                                 MOVRA   DLY1
012C   2800           00405                                 GOTO    GET_STATE_EXIT
012D                  00406 K3_PRS_CHK:
012D   3193           00407                                 JBSET   F_T3
012E   2800           00408                                 GOTO    GET_STATE_EXIT
012F   3D93           00409                                 BCLR    F_T3
0130   3B93           00410                                 BSET    F_WK2
0131   0B66           00411                                 MOVAI   102
0132   159F           00412                                 MOVRA   DLY2
0133                  00413 GET_STATE_EXIT:
0133   000C           00414                                 RETURN
                      00415 ;=======================================
0134                  00416 OUTPUT:
0134   000E           00417                                 CLRWDT
0135                  00418 WK0_CHK:
0135   3293           00419                                 JBSET   F_WK0
0136   2800           00420                                 GOTO    WK0_STOP
0137   3905           00421                                 BSET    P_SLED
0138   3805           00422                                 BSET    P_PSW3
0139   2800           00423                                 GOTO    WK1_CHK
013A                  00424 WK0_STOP:
013A   3FC8           00425                                 BCLR    PWM1AOE
013B   3D06           00426                                 BCLR    P_PWMA
013C   3D05           00427                                 BCLR    P_SLED
013D   3313           00428                                 JBSET   F_WK1
013E   3C05           00429                                 BCLR    P_PSW3
013F                  00430 WK1_CHK:
013F   3313           00431                                 JBSET   F_WK1
0140   2800           00432                                 GOTO    WK1_STOP
0141   3985           00433                                 BSET    P_RLED
0142   3805           00434                                 BSET    P_PSW3
0143   349C           00435                                 JBCLR   STG2,1
0144   2800           00436                                 GOTO    WK1_STG1
0145   351C           00437                                 JBCLR   STG2,2
0146   2800           00438                                 GOTO    WK1_STG2
0147   2800           00439                                 GOTO    WK2_CHK
0148                  00440 WK1_STG1:
0148   321A           00441                                 JBSET   F_INC_EN
0149   2800           00442                                 GOTO    WK2_CHK
014A   3E1A           00443                                 BCLR    F_INC_EN
014B   19A1           00444                                 INCR    TM_CNT
014C   0B1F           00445                                 MOVAI   31
014D   1221           00446                                 RSUBAR  TM_CNT
014E   3003           00447                                 JBSET   C
014F   2800           00448                                 GOTO    WK1_STG1_1
0150   3EC8           00449                                 BCLR    PWM1COE
0151   3C06           00450                                 BCLR    P_PWMC
0152   0B3D           00451                                 MOVAI   61
0153   1221           00452                                 RSUBAR  TM_CNT
0154   3003           00453                                 JBSET   C
0155   2800           00454                                 GOTO    WK2_CHK
0156   1DA1           00455                                 CLRR    TM_CNT
0157                  00456 WK1_STG1_1:
0157   3AC8           00457                                 BSET    PWM1COE
0158   2800           00458                                 GOTO    WK2_CHK
0159                  00459 WK1_STG2:
0159   321A           00460                                 JBSET   F_INC_EN
015A   2800           00461                                 GOTO    WK2_CHK
015B   3E1A           00462                                 BCLR    F_INC_EN
015C   319A           00463                                 JBSET   F_UP
015D   2800           00464                                 GOTO    WK1_STG2_DEC
015E   0B02           00465                                 MOVAI   2
015F   1FA2           00466                                 ADDRA   DUTY_BK
0160   0B7D           00467                                 MOVAI   125
0161   1222           00468                                 RSUBAR  DUTY_BK
0162   3403           00469                                 JBCLR   C       
0163   3D9A           00470                                 BCLR    F_UP
0164   2800           00471                                 GOTO    WK1_STG2_COM
0165                  00472 WK1_STG2_DEC:
0165   0B02           00473                                 MOVAI   2
0166   1222           00474                                 RSUBAR  DUTY_BK
0167   3403           00475                                 JBCLR   C
0168   2800           00476                                 GOTO    WK1_STG2_DECPRO
0169   399A           00477                                 BSET    F_UP
016A   0B02           00478                                 MOVAI   2
016B   15A2           00479                                 MOVRA   DUTY_BK
016C   2800           00480                                 GOTO    WK1_STG2_COM
016D                  00481 WK1_STG2_DECPRO:
016D   0B02           00482                                 MOVAI   2
016E   12A2           00483                                 RSUBRA  DUTY_BK
016F                  00484 WK1_STG2_COM:
016F   1622           00485                                 MOVAR   DUTY_BK
0170   15CA           00486                                 MOVRA   T1DATC
0171   2800           00487                                 GOTO    WK2_CHK
0172                  00488 WK1_STOP:
0172   3F48           00489                                 BCLR    PWM1BOE
0173   3EC8           00490                                 BCLR    PWM1COE
0174   3C86           00491                                 BCLR    P_PWMB
0175   3C06           00492                                 BCLR    P_PWMC
0176   3D85           00493                                 BCLR    P_RLED
0177   3293           00494                                 JBSET   F_WK0
0178   3C05           00495                                 BCLR    P_PSW3
0179                  00496 WK2_CHK:
0179   161F           00497                                 MOVAR   DLY2
017A   0800           00498                                 XORAI   0
017B   3103           00499                                 JBSET   Z
017C   2800           00500                                 GOTO    WK2_1
017D   3C85           00501                                 BCLR    P_KLED
017E   2800           00502                                 GOTO    OUTPUT_EXIT
017F                  00503 WK2_1:
017F   3885           00504                                 BSET    P_KLED
0180                  00505 OUTPUT_EXIT:
0180   000C           00506                                 RETURN
                      00507 ;=======================================
0181                  00508 HDWARE_INITIAL:
0181   0B38           00509                                 MOVAI   00111000B
0182   15C6           00510                                 MOVRA   DDR1
0183   0B00           00511                                 MOVAI   0X00
0184   15C5           00512                                 MOVRA   DDR0
0185   1585           00513                                 MOVRA   P0
0186   1586           00514                                 MOVRA   P1
0187   158C           00515                                 MOVRA   ODCON
0188   0BFF           00516                                 MOVAI   0XFF
0189   158B           00517                                 MOVRA   PUDCON
018A   0BE7           00518                                 MOVAI   11100111B
018B   158D           00519                                 MOVRA   PUCON
018C   0B80           00520                                 MOVAI   10000000B
018D   1588           00521                                 MOVRA   MCR
018E   0B05           00522                                 MOVAI   00000101B
018F   15C1           00523                                 MOVRA   T0CR
0190   0B00           00524                                 MOVAI   00000000B
0191   15C3           00525                                 MOVRA   CMPCR
0192   15CB           00526                                 MOVRA   TM0CR
0193   1581           00527                                 MOVRA   T0CNT
0194   15C0           00528                                 MOVRA   P0KBCR
0195   158F           00529                                 MOVRA   INTF
0196   15C4           00530                                 MOVRA   INTF1
0197   0B38           00531                                 MOVAI   00111000B
0198   1589           00532                                 MOVRA   P1KBCR
0199   0B00           00533                                 MOVAI   0X00
019A   158E           00534                                 MOVRA   INTE
019B   0B42           00535                                 MOVAI   01000010B
019C   15CC           00536                                 MOVRA   T1CR
019D   0B7D           00537                                 MOVAI   125
019E   15CD           00538                                 MOVRA   T1CNT
019F   15CE           00539                                 MOVRA   T1LOAD
01A0   0B40           00540                                 MOVAI   64
01A1   15CF           00541                                 MOVRA   T1DATA
01A2   15C9           00542                                 MOVRA   T1DATB
01A3   15CA           00543                                 MOVRA   T1DATC
01A4   0B00           00544                                 MOVAI   0
01A5   15C2           00545                                 MOVRA   T1DATD
01A6   15C7           00546                                 MOVRA   PWMCR1
01A7   0B03           00547                                 MOVAI   00000011B
01A8   15C8           00548                                 MOVRA   PWMCR0
                      00549                                 
01A9   000C           00550                                 RETURN
                      00551 ;=======================================
01AA                  00552 RAM_CLR:
01AA   0B10           00553                                 MOVAI   0X10
01AB   1584           00554                                 MOVRA   FSR
01AC                  00555 RM_CLR_LP:
01AC   000E           00556                                 CLRWDT
01AD   1D80           00557                                 CLRR    INDF
01AE   1984           00558                                 INCR    FSR
01AF   1604           00559                                 MOVAR   FSR
01B0   0840           00560                                 XORAI   0X40
01B1   3103           00561                                 JBSET   Z
01B2   2800           00562                                 GOTO    RM_CLR_LP
01B3   000C           00563                                 RETURN
                      00564 ;=======================================
01B4                  00565 USR_INITIAL:
01B4   0B7A           00566                                 MOVAI   122
01B5   1597           00567                                 MOVRA   HALT_CNT
01B6   3BCC           00568                                 BSET    T1EN
01B7   3B8E           00569                                 BSET    GIE
01B8   000C           00570                                 RETURN
                      00571 ;=======================================
                      00572                                 END
gpasm-2.2.15 (Dec 17 2019)   Charge_Mc30p6240(14sop)_xxxx.asm2020-6-30  15:50:10          PAGE  2


SYMBOL TABLE
  LABEL                             VALUE

A_STG1                            000000CB
A_STG2                            000000CE
A_STG3                            000000B8
B_STG1                            000000FE
B_STG2                            00000104
B_STG3                            0000010D
B_STG4                            00000117
B_STG5                            000000E4
CMPCR                             00000043
DDR0                              00000045
DDR1                              00000046
FSR                               00000004
GET_STATE                         000000B2
GET_STATE_EXIT                    00000133
GPR0                              00000007
HALT_CHK                          0000003E
HDWARE_INITIAL                    00000181
INDF                              00000000
INTE                              0000000E
INTF                              0000000F
INTF1                             00000044
INT_EXIT                          00000028
K1_HLD_CHK                        000000D1
K1_HLD_PRO                        00000094
K1_PRO                            0000008F
K2_HLD_CHK                        0000011D
K2_HLD_PRO                        0000009C
K2_PRO                            00000097
K2_PRS_CHK                        000000DF
K3_PRO                            0000009F
K3_PRS_CHK                        0000012D
KEY_HLD_CHK                       00000076
KEY_SCAN                          00000058
KEY_SCAN_EXIT                     000000B1
K_PRS_HLD_CHK                     00000080
MAIN                              00000039
MCR                               00000008
NEWKEY_PRO                        000000A2
NOKEY_PRO                         000000A8
ODCON                             0000000C
OUTPUT                            00000134
OUTPUT_EXIT                       00000180
P0                                00000005
P0KBCR                            00000040
P1                                00000006
P1KBCR                            00000009
PCL                               00000002
PCLATH                            0000000A
PUCON                             0000000D
PUDCON                            0000000B
PWMCR0                            00000048
PWMCR1                            00000047
PWON_Start                        0000002D
PWON_WAIT                         00000033
RAM_CLR                           000001AA
RM_CLR_LP                         000001AC
STATUS                            00000003
STOP_PWMA                         000000D6
STOP_PWMBC                        00000122
T0CNT                             00000001
T0CR                              00000041
T1CNT                             0000004D
T1CR                              0000004C
T1DATA                            0000004F
T1DATB                            00000049
T1DATC                            0000004A
T1DATD                            00000042
T1LOAD                            0000004E
TM0CR                             0000004B
USR_INITIAL                       000001B4
WK0_CHK                           00000135
WK0_STG_CHK                       000000C0
WK0_STOP                          0000013A
WK1_CHK                           0000013F
WK1_STG1                          00000148
WK1_STG1_1                        00000157
WK1_STG2                          00000159
WK1_STG2_COM                      0000016F
WK1_STG2_DEC                      00000165
WK1_STG2_DECPRO                   0000016D
WK1_STG_CHK                       000000EF
WK1_STOP                          00000172
WK2_1                             0000017F
WK2_CHK                           00000179
_CONFIG0                          00008000
_CONFIG1                          00008001
__1K6240                          00000001
ACCBUF                            0x11
BUZ1EN                            T1CR,5
C                                 STATUS,0
CMPEN                             MCR,0
CMPIE                             CMPCR,2
CMPIF                             INTF1,2
CMPOF                             MCR,5
CNT50MS                           0X20
CPIES                             CMPCR,1
CPNIS0                            MCR,1
CPNIS1                            MCR,2
CPNIS2                            MCR,3
CPNIS3                            MCR,4
CPPIS                             CMPCR,0
DBCLK                             PWMCR0,4
DC                                STATUS,1
DDR00                             DDR0,0
DDR01                             DDR0,1
DDR02                             DDR0,2
DDR03                             DDR0,3
DDR10                             DDR1,0
DDR11                             DDR1,1
DDR12                             DDR1,2
DDR13                             DDR1,3
DDR14                             DDR1,4
DDR15                             DDR1,5
DDR16                             DDR1,6
DDR17                             DDR1,7
DEBOUNCE                          0X15
DLY1                              0X1E
DLY2                              0X1F
DUTY_BK                           0X22
EIS                               MCR,6
FLAG0                             0X13
FLAG1                             0X1A
FLAGBUF                           0x10
FSR0                              FSR,0
FSR1                              FSR,1
FSR2                              FSR,2
FSR3                              FSR,3
FSR4                              FSR,4
FSR5                              FSR,5
FSR6                              FSR,6
F_ACTED                           FLAG1,0
F_H1                              KFLAG,4
F_H2                              KFLAG,5
F_HOLD                            KFLAG,7
F_INC_EN                          FLAG1,4
F_K_RND                           FLAG0,0
F_NO_WK                           FLAG1,1
F_PR1                             KFLAG,0
F_PR2                             KFLAG,1
F_PR3                             KFLAG,2
F_PRESSED                         KFLAG,6
F_PRS                             KFLAG,3
F_T1                              FLAG0,1
F_T2                              FLAG0,2
F_T3                              FLAG0,3
F_UP                              FLAG1,3
F_WK0                             FLAG0,5
F_WK1                             FLAG0,6
F_WK1_1                           FLAG1,2
F_WK2                             FLAG0,7
GIE                               INTE,7
HALT_CNT                          0X17
HOLD_CNT                          0X16
INDF0                             INDF,0
INDF1                             INDF,1
INDF2                             INDF,2
INDF3                             INDF,3
INDF4                             INDF,4
INDF5                             INDF,5
INDF6                             INDF,6
INDF7                             INDF,7
INTIE                             INTE,2
INTIF                             INTF,2
INTM                              T0CR,6
KBIE                              INTE,1
KBIF                              INTF,1
KEYIN                             0X18
KEYOLD                            0X19
KEY_CNT                           0X23
KFLAG                             0X14
P00D                              P0,0
P00KE                             P0KBCR,0
P00PU                             PUDCON,0
P01D                              P0,1
P01KE                             P0KBCR,1
P01PU                             PUDCON,1
P02D                              P0,2
P02KE                             P0KBCR,2
P02PU                             PUDCON,2
P03D                              P0,3
P03KE                             P0KBCR,3
P03PU                             PUDCON,3
P10D                              P1,0
P10KE                             P1KBCR,0
P10OD                             ODCON,0
P10PD                             PUDCON,4
P10PU                             PUCON,0
P11D                              P1,1
P11KE                             P1KBCR,1
P11OD                             ODCON,1
P11PD                             PUDCON,5
P11PU                             PUCON,1
P12D                              P1,2
P12KE                             P1KBCR,2
P12OD                             ODCON,2
P12PD                             PUDCON,6
P12PU                             PUCON,2
P13D                              P1,3
P13KE                             P1KBCR,3
P13PU                             PUCON,3
P14D                              P1,4
P14KE                             P1KBCR,4
P14OD                             ODCON,4
P14PU                             PUCON,4
P15D                              P1,5
P15KE                             P1KBCR,5
P15OD                             ODCON,5
P15PU                             PUCON,5
P16D                              P1,6
P16KE                             P1KBCR,6
P16OD                             ODCON,6
P16PU                             PUCON,6
P17D                              P1,7
P17KE                             P1KBCR,7
P17OD                             ODCON,7
P17PU                             PUCON,7
PC0                               PCL,0
PC1                               PCL,1
PC2                               PCL,2
PC3                               PCL,3
PC4                               PCL,4
PC5                               PCL,5
PC6                               PCL,6
PC7                               PCL,7
PCH0                              PCLATH,0
PCH1                              PCLATH,1
PD                                STATUS,3
PWM1AEN                           T1CR,6
PWM1AOE                           PWMCR0,7
PWM1AOS                           PWMCR1,7
PWM1BEN                           PWMCR0,1
PWM1BOE                           PWMCR0,6
PWM1CEN                           PWMCR0,0
PWM1COE                           PWMCR0,5
PWM1DEN                           PWMCR1,0
PWM1DOE                           PWMCR1,1
PWM1DOS                           PWMCR1,4
PWM1LG                            PWMCR0,2
PWM1MD                            PWMCR0,3
P_KLED                            P01D
P_KYK                             P15D
P_KYR                             P13D
P_KYS                             P14D
P_PSW3                            P00D
P_PWMA                            P12D
P_PWMB                            P11D
P_PWMC                            P10D
P_RLED                            P03D
P_SLED                            P02D
RST                               STATUS,7
STG1                              0X1B
STG2                              0X1C
STG3                              0X1D
T0CNT0                            T0CNT,0
T0CNT1                            T0CNT,1
T0CNT2                            T0CNT,2
T0CNT3                            T0CNT,3
T0CNT4                            T0CNT,4
T0CNT5                            T0CNT,5
T0CNT6                            T0CNT,6
T0CNT7                            T0CNT,7
T0IE                              INTE,0
T0IF                              INTF,0
T0PRS0                            T0CR,0
T0PRS1                            T0CR,1
T0PRS2                            T0CR,2
T0PTA                             T0CR,3
T0PTS                             T0CR,5
T0SE                              T0CR,4
T0TBS                             TM0CR,7
T1CKS0                            T1CR,3
T1CKS1                            T1CR,4
T1CNT0                            T1CNT,0
T1CNT1                            T1CNT,1
T1CNT2                            T1CNT,2
T1CNT3                            T1CNT,3
T1CNT4                            T1CNT,4
T1CNT5                            T1CNT,5
T1CNT6                            T1CNT,6
T1CNT7                            T1CNT,7
T1DATA0                           T1DATA,0
T1DATA1                           T1DATA,1
T1DATA2                           T1DATA,2
T1DATA3                           T1DATA,3
T1DATA4                           T1DATA,4
T1DATA5                           T1DATA,5
T1DATA6                           T1DATA,6
T1DATA7                           T1DATA,7
T1DATB0                           T1DATB,0
T1DATB1                           T1DATB,1
T1DATB2                           T1DATB,2
T1DATB3                           T1DATB,3
T1DATB4                           T1DATB,4
T1DATB5                           T1DATB,5
T1DATB6                           T1DATB,6
T1DATB7                           T1DATB,7
T1DATC0                           T1DATC,0
T1DATC1                           T1DATC,1
T1DATC2                           T1DATC,2
T1DATC3                           T1DATC,3
T1DATC4                           T1DATC,4
T1DATC5                           T1DATC,5
T1DATC6                           T1DATC,6
T1DATC7                           T1DATC,7
T1DATD0                           T1DATD,0
T1DATD1                           T1DATD,1
T1DATD2                           T1DATD,2
T1DATD3                           T1DATD,3
T1DATD4                           T1DATD,4
T1DATD5                           T1DATD,5
T1DATD6                           T1DATD,6
T1DATD7                           T1DATD,7
T1EN                              T1CR,7
T1IE                              TM0CR,1
T1IF                              TM0CR,0
T1LOAD0                           T1LOAD,0
T1LOAD1                           T1LOAD,1
T1LOAD2                           T1LOAD,2
T1LOAD3                           T1LOAD,3
T1LOAD4                           T1LOAD,4
T1LOAD5                           T1LOAD,5
T1LOAD6                           T1LOAD,6
T1LOAD7                           T1LOAD,7
T1PRS0                            T1CR,0
T1PRS1                            T1CR,1
T1PRS2                            T1CR,2
TMP0                              0X12
TM_CNT                            0X21
TO                                STATUS,4
WDTEN                             MCR,7
Z                                 STATUS,2

Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     0 reported,     0 suppressed

